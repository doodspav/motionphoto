repos:

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-byte-order-marker
      - id: check-case-conflict
      - id: check-executables-have-shebangs
      - id: check-json
      - id: check-shebang-scripts-are-executable
      - id: check-symlinks
      - id: check-toml
      - id: check-vcs-permalinks
      - id: check-xml
      - id: check-yaml
      - id: debug-statements
      - id: destroyed-symlinks
      - id: detect-private-key

  # Using this mirror lets us use mypyc-compiled black, which is about 2x faster
  - repo: https://github.com/psf/black-pre-commit-mirror
    rev: 24.4.0
    hooks:
      - id: black
        args: [--check]

  - repo: local
    hooks:
      - id: flake8
        name: flake8
        language: script
        types: [python]
        entry: venv/bin/flake8
        exclude: ^tests/

  - repo: local
    hooks:
      - id: mypy
        name: mypy
        language: script
        types: [python]
        entry: venv/bin/mypy
        exclude: ^tests/

  - repo: local
    hooks:
      - id: pylint
        name: pylint
        language: script
        types: [python]
        entry: venv/bin/pylint
        args: [--fail-under=10]
        exclude: ^tests/

  - repo: local
    hooks:
      - id: unittest-integration
        name: unittest-integration
        language: script
        types: [python]
        entry: venv/bin/python
        args: [-m, coverage, run, --data-file=.coverage.integration, --omit="motionphoto/*", --branch, -m, unittest, discover, -s, tests/integration]
        pass_filenames: false
        always_run: true

  - repo: local
    hooks:
      - id: unittest-unit
        name: unittest-unit
        language: script
        types: [python]
        entry: venv/bin/python
        args: [-m, coverage, run, --data-file=.coverage.unit, --branch, -m, unittest, discover, -s, tests/unit]
        pass_filenames: false
        always_run: true

  - repo: local
    hooks:
      - id: coverage-combine
        name: coverage-combine
        language: script
        types: [python]
        entry: venv/bin/python
        args: [-m, coverage, combine]
        pass_filenames: false
        always_run: true

  - repo: local
    hooks:
      - id: coverage-report
        name: coverage-report
        language: script
        types: [python]
        entry: venv/bin/python
        args: [-m, coverage, report, --fail-under=100]
        pass_filenames: false
        always_run: true

  - repo: local
    hooks:
      - id: build-docs
        name: build-docs
        language: script
        types_or: [python, markdown, rst]
        entry: venv/bin/sphinx-build
        args: [-M, html, docs/source, docs/build, --fresh-env, --nitpicky, --silent, --fail-on-warning, --keep-going, --show-traceback]
        pass_filenames: false
